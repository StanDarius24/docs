---
- Using the Spring web scopes
- Implementing a simple login functionality for a web app
- Redirecting from one page to another in a web app
---

Using the Spring web scopes:
In web apps you can use other bean scopes that are relevant only to web applications. We call them web scopes:
- Request scope—Spring creates an instance of the bean class for every HTTP request. The instance exists only for that specific HTTP request.
- Session scope—Spring creates an instance and keeps the instance in the server’s memory for the full HTTP session. Spring links the instance in the context with the client’s session.
- Application scope—The instance is unique in the app’s context, and it’s available while the app is running

9.1 Using the request scope in a Spring web app
A request-scoped bean is an object managed by Spring, for which the framework creates a new instance for every HTTP request. The app can use the instance only for the request that created it. Any new HTTP request (from the same or other clients) creates and uses a different instance of the same class.

| Fact                                                                  | Consequence                                                                                                                                | To consider                                                                                                                                                                                                                                                                         | to avoid                                                                                                                                                                                                                                                                     |
| --------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Spring creates a new instance for every HTTP request from any client. | Spring creates a lot of instances of this bean in the app’s memory during its execution.                                                   | The number of instances is usually not a big problem because these instances are short-lived. The app doesn’t need them for more than the time the HTTP request needs to complete. Once the HTTP request completes, the app releases the instances, and they are garbage-collected. | However, make sure you don’t implement a time consuming logic Spring needs to execute to create the instance (like getting data from a database or implementing a network call). Avoid writing logic in the constructor or a @PostConstruct method for request-scoped beans. |
| Only one request can use an instance of a request scoped bean.        | Instances of request-scoped beans are not prone to multithread-related issues as only one thread (the one of the request) can access them. | You can use the instance’s attributes to store data used by request.                                                                                                                                                                                                                | Don’t use synchronization techniques for the attributes of these beans. These techniques would be redundant, and they only affect the performance of your app.                                                                                                               | 

---

9.2 Using the session scope in a Spring web app
A session-scoped bean is an object managed by Spring, for which Spring creates an instance and links it to the HTTP session. Once a client sends a request to the server, the server reserves a place in the memory for this request, for the whole duration of their session. Spring creates an instance of a session-scoped bean when the HTTP session is created for a specific client. That instance can be reused for the same client while it still has the HTTP session active. The data you store in the session scoped bean attribute is available for all the client’s requests throughout an HTTP session. This approach of storing the data allows you to store information about what users do while they’re surfing through the pages of your app.
A couple of features you can implement using session-scoped beans include the following examples:
- A login—Keeps details of the authenticated user while they visit different parts off your app and send multiple requests.
- An online shopping cart—Users visit multiple places in your app, searching for products they add to the cart. The cart remembers all the products the client added.

| Fact                                                                                                     | Consequence                                                                                                                                                        | To consider                                                                                                                                                                                                                                                                                                                                                        | to avoid                                                                                                                                                                                                                    |
| -------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| The session scoped bean instances are kept for the entire HTTP session.                                  | They have a longer life, and they are less frequently garbage-collected than the request scoped beans.                                                             | The app keeps the data you store in the session-scoped beans for a more extended period.                                                                                                                                                                                                                                                                           | Avoid keeping too much data on the session. It can potentially become a performance problem. Moreover, never store sensitive details (like passwords, private keys, or any other secret detail) in session bean attributes. |
| Multiple requests can share the session scoped bean instance.                                            | If the same client issues multiple concurrent requests that change the data on the instance, you may encounter multithreading related issues like race conditions. | When you know such a scenario is possible, you might need to use synchronization techniques to avoid concurrency. However, I generally recommend you see if this can be avoided and keep synchronization only as a last resort when it can’t be avoided.                                                                                                           |                                                                                                                                                                                                                             |
| The session scoped beans are a way to share data among requests by keeping the data on  the server side. | The logic you implement might imply requests become dependent one on the other.                                                                                    | When keeping details stateful in one app’s memory, you make clients dependent on that specific app instance. Before deciding to implement some feature with a session-scoped bean, consider alternatives, such as storing the data you want to share in a database instead of the session. This way, you can leave the HTTP requests independent one from another. |                                                                                                                                                                                                                             |

9.3 Using the application scope in a Spring web app
All client requests share an application-scoped bean.The application scope is close to how a singleton works. The difference is that you can’t have more instances of the same type in the context and that we always use the HTTP requests as a reference point when discussing the life cycle of web scopes. We face the same concurrency problems we discussed in chapter 5 for the singleton beans for application-scoped beans: it’s better to have immutable attributes for the singleton beans. The same advice is applicable to an application-scoped bean. But if you make the attributes immutable, then you can directly use a singleton bean instead.

Summary:
1. Aside from the singleton and prototype bean scopes, you can benefit from using three more bean scopes in a Spring web app. These scopes only make sense in web apps, and that’s why we call them web scopes:
	- Request scope—Spring creates an instance of the bean for each HTTP request.
	- Session scope—Spring creates an instance of the bean per HTTP session of the client. Multiple requests from the same client can share the same instance.
	- Application scope—There’s only one instance for the whole application for that specific bean. Every request from any client can access this instance.
2. Spring guarantees that a request-scoped bean instance is only accessible by one HTTP request. For this reason, you can use the instance’s attributes without worrying about concurrency-related problems. Also, you don’t need to worry that they might fill the app’s memory. Being they are short-lived, the instances can be garbage-collected once the HTTP request ends.
3. Spring creates request-scoped bean instances for every HTTP request. This is quite often. You preferably shouldn’t make the instance’s creation difficult by implementing logic in the constructor or a @PostConstruct method.
4. Spring links a session-scoped bean instance to the HTTP session of the client. This way, a session-scoped bean instance can be used to share data among multiple HTTP requests from the same client.
5. Even if from the same client, the client can send HTTP requests concurrently. If these requests change data in the session-scoped instance, they might get into race-condition scenarios. You need to consider such situations and either avoid them or synchronize your code to support the concurrency.
6. I recommend avoiding the use of application-scoped bean instances. With application-scoped bean instances being shared by all the web app requests, any write operation usually needs synchronization, creating bottlenecks and dramatically affecting the app’s performance. Moreover, these beans live in your app’s memory as long as the app itself, so they can’t be garbage-collected. A better approach is to directly store the data in a database.
7. Both session- and application-scoped beans imply making requests less inde pendent. We say the application manages the state the requests need (or that the app is stateful). A stateful app implies different architectural problems that are best to avoid. 